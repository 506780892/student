define(function(){
    var hasAddCss=false;
   return {
       data:function(){
           return {
               status:0//0为暂停，1为播放，2为停止
           }
       },
       methods:{
           content:function(createE){
               var _self=this;
               return [
                   createE("div",{
                       staticClass:"full full-video",
                       on:{
                           click:function(e){
                               e.stopPropagation();
                               e.preventDefault();
                               return false;
                           }
                       }
                   },[
                       createE("video",{
                           staticClass:"video page",
                           class:{
                               hide:_self.status!==1
                           },
                           ref:"video",
                           style:{
                               "object-fit":" fill",
                               "background":"#000"
                           },
                           attrs:{
                               'x-webkit-airplay':true,
                               'webkit-playsinline':true,
                               'playsinline':true,
                               'x5-playsinline':true,
                               'x5-video-player-type':"h5",
                               'x5-video-player-fullscreen':true,
                               'x5-video-orientation':'portraint',
                               preload:true,
                               // autoplay:true,
                               src:((_self.origin||"")+_self.videoSrc)
                           }
                       }),
                       createE("div",{
                           staticClass:"video-mask page",
                           class:{
                               hide:_self.status===1
                           },
                           style:{
                               backgroundImage:"url("+_self.imgSrc+")",
                               zIndex:1
                           }

                       },[
                           createE("div",{
                               staticClass:"mask"
                           })
                       ]),
                       createE("div",{
                           staticClass:"control page",
                           style:{
                               zIndex:2
                           },
                           class:{
                               hide:_self.status!==0
                           },
                           on:{
                               mousedown:function(){
                                   _self.$refs["video"].play();
                               },
                               touchstart:function(){
                                   _self.$refs["video"].play()
                               }
                           }
                       }),
                       createE("div",{
                           staticClass:"video-end page",
                           ref:"videoEnd",
                           style:{
                               zIndex:3
                           },
                           class:{
                               hide:_self.status!==2
                           }
                       },[
                           createE("div",{
                               staticClass:"video-end-box"
                           },[
                               createE("img",{
                                   staticClass:"icon",
                                   attrs:{
                                       src:_self.gameIcon
                                   }
                               }),
                               createE("div",{
                                   staticClass:"name",
                                   domProps:{
                                       innerHTML:_self.gameName
                                   }
                               }),
                               createE("span",{
                                   staticClass:"btn btn-play",
                                   domProps:{
                                       innerHTML:"重播"
                                   },
                                   on:{
                                       click:function(){
                                           _self.replay();
                                       }
                                   }
                               }),
                               createE("span",{
                                   staticClass:"btn btn-dl",
                                   domProps:{
                                       innerHTML:"立即下载"
                                   },
                                   on:{
                                       click:function(){
                                           _self.download();
                                       }
                                   }
                               })
                           ])
                       ]),
                       createE("div",{
                           staticClass:"tips",
                           style:{
                               zIndex:4
                           }
                       },[
                           createE("p",{
                               staticClass:"title",
                               domProps:{
                                   innerHTML:"@"+_self.gameName
                               }
                           }),
                           createE("p",{
                               staticClass:"desc",
                               domProps:{
                                   innerHTML:_self.gameDesc
                               }
                           }),
                           createE("span",{
                               staticClass:"btn",
                               domProps:{
                                   innerHTML:"点我玩玩"
                               },
                               on:{
                                   click:function(){
                                       _self.download();
                                   }
                               }
                           })
                       ]),
                       createE("div",{
                           staticClass:"dl",
                           ref:"download",
                           style:{
                               zIndex:5
                           }
                       },[
                           createE("div",{
                               staticClass:"dl-info",
                           },[
                               createE("img",{
                                   staticClass:"dl-icon",
                                   attrs:{
                                       src:_self.gameIcon
                                   }
                               }),
                               createE("span",{
                                   staticClass:"dl-close",
                                   domProps:{
                                       innerHTML:"X"
                                   },
                                   on:{
                                       click:function(){
                                           _self.$refs["download"].classList.add("hide");
                                       }
                                   }
                               }),
                               createE("p",{
                                   staticClass:"title",
                                   domProps:{
                                       innerHTML:_self.gameName
                                   }
                               }),
                               createE("p",{
                                   staticClass:"desc",
                                   domProps:{
                                       innerHTML:_self.gameDesc
                                   }
                               }),
                           ]),
                           createE("span",{
                               staticClass:"btn",
                               domProps:{
                                   innerHTML:"点我玩玩"
                               },
                               on:{
                                   click:function(){
                                       _self.download();
                                   }
                               }
                           })
                       ])
                   ])
               ]
           },
           addCss:function(){
               var headEle,styleEle;
               if(hasAddCss){
                   return ;
               }
               headEle=document.querySelector("head");
               styleEle=document.createElement("link");
               styleEle.setAttribute("href",require.toUrl("components").replace(/\?.*/g,"")+"full.video/index.css");
               styleEle.setAttribute("rel","stylesheet");
               headEle.appendChild(styleEle);
               hasAddCss=true;
           },
           replay:function(){
                var _self=this;
                _self.$refs["video"].play();
               _self.$refs["video"].classList.remove("hide");
               _self.$refs["videoEnd"].classList.add("hide")
           },
           download:function(){
               var _self=this;
               $('#app').find("a").click()
           }
       },
       props:{
           imgSrc:{
               default:require.toUrl("components").replace(/\?.*/g,"")+"/default.jpg",
               editType:"img",
               text:"封面图片"
           },
           videoSrc:{
               default:require.toUrl("components").replace(/\?.*/g,"")+"/default.jpg",
               editType:"video",
               text:"视频"
           },
           gameIcon:{
               default:"",
               editType:"img",
               text:"游戏图标"
           },
           gameName:{
               default:"游戏名",
               editType:"text",
               text:"游戏名"
           },
           gameDesc:{
               default:"游戏描述",
               editType:"text",
               text:"游戏描述"
           }
       },
       mounted:function(){
           var _self=this,eParent=null;
           _self.$refs["video"].addEventListener("ended",function(){
               _self.status=2;
           });
           _self.$refs["video"].addEventListener("play",function(){
               _self.status=1;
           })
           _self.$refs["video"].addEventListener("timeupdate",function(){
               _self.status=1;
           })

           _self.addCss();

           eParent=_self.$el.parentNode;
           while(eParent){
               if(eParent.classList.contains("component")){
                   eParent.style["position"]="static";
                   break;
               }
               if(eParent===document.body){
                   break;
               }
               eParent=eParent.parentNode;
           }
       },
       config:{
           group:"功能模块",
           text:"全屏视频"
       }
   }
});